# 医闹黑名单 软件使用简介

YinaoBlacklist（医闹黑名单）是一个管理医闹数据库的软件，它可以导入、导出、合并数据记录，查询某患者是否曾经有医闹的记录。

它是一款完全离线的软件，不存在一个中心化的网站或App存储着全部的医闹记录。用户需要通过其他渠道，例如微信、百度云盘等等，交换自己维护的医闹记录。希望有心人能汇总各地医生积累的医闹记录，供同仁参考。

YinaoBlacklist所支持的数据记录文件是普通的纯文本文件，其格式也非常简单，以方便利用微信来传播这些文件。

#### 技术背景

YinaoBlacklist在隐藏患者具体身份信息的情况下，依然能够对其进行查询，实现这一目标的手段是哈希（hash）函数，具体而言，本软件使用的是sha256哈希函数。

哈希函数可以把任意信息转化为固定长度的“特征值”，例如sha256得到的特征值是32字节长。哈希函数满足如下要求：

1. 相同的输入信息得到相同的特征值；而不同的输入信息得到不同的特征值，哪怕输入信息只有一个比特不同，得到的特征值也大相径庭
2. 从特征值无法反推得到输入的信息

YinaoBlacklist并不保存用户的身份证号，它保存的是身份证号的哈希值。你无法从身份证号的哈希值反推得到身份证号。也就是说，你无法知道YinaoBlacklist到底保存着哪些患者的黑名单。但是，当你得到一个患者的身份证号的时候，你可以利用YinaoBlacklist查询得知此患者在不在黑名单里面。



以下介绍YinaoBlacklist所能提供的四项基本功能，这四项功能对应于软件界面上的四个标签页。

#### 将原始记录文件转为加密记录文件

YinaoBlacklist可以将若干条原始医闹记录逐一编码为加密的医闹记录。



一条原始的医闹记录包含若干行**连续**的文本，其中：

1. 第一行是患者的姓名、性别和出生年份这三项信息，用两个中文逗号把它们隔开
2. 第二行是患者的身份证号，如果无法提供则以“NA”来代替（NA=Not Available）
3. 第三行是置信指数，它是一个百分数，最大为100，最小为0，表示这条记录在多大程度上是可信的（此记录是您的亲身经历，则填写100；是道听途说的，则填写小于100的值）
4. 其他行是对于患者医闹记录的文本描述

一条原始的医闹记录必须是连续的，中间不能有空行。空行被用来分割不同的记录。

原始的医闹记录，需要由医生用文本文件编辑器（例如Windows自带记事本），或者用Word来撰写，写好后保存为文本文件。



一条加密的医闹记录包括5行文本：

1. 第一行：用患者姓名，性别，出生年份，进行sha256后得到的哈希码（base64编码）
2. 第二行：用患者的身份证号，进行sha256后得到的哈希码（base64编码），如果无法提供则以NA代替
3. 第三行：置信指数
4. 第四行：对于患者医闹记录的文本描述，必须放在一整行里，如果原始记录是多行的，那么用"\n"来表示换行
5. 第五行：前面第一、二、四行的CRC32校验码（Hex编码）



YinaoBlacklist会把加密的医闹记录保存在以.yinao.txt结尾的文本文件中，此文件同对应的原始记录文件位于同一个目录中。

由于.yinao.txt文本文件是完全可读可编辑的文件，您可以使用任何文本编辑工具对其中的记录进行删除，或者修改置信参数。

#### 扫描并且合并加密记录文件

YinaoBlacklist能够扫描硬盘上的若干目录及其子目录（软件的图形界面上允许指定16个目录），读取其中以.yinao.txt结尾的文本文件，获得这些文件中所有的医闹记录，去掉重复的记录之后，生成一个单一的记录文件。对若干条内容完全相同、但置信参数不同的重复记录进行去重的时候，只留下置信参数最高的一个，其他的会被删除。

这一功能主要用来扫描微信群聊天中群友贴出来的文本文件。众所周知，微信桌面版只要在线，就会把微信群中出现过的文件都保存在硬盘上。医生在同学、同事群中所转发的.yinao.txt文本文件，都会被微信桌面版自动保存在硬盘上。群里的有心人或者志愿者，会一直开着一台PC连着微信，用来搜集这些文本文件，合并之后，再转发给其他的同学、同事。利用同学、同事的社交网络，一位医生所新增的医闹记录，可以在6跳（六度连接理论）之内，到达所有的医生。

在合并时，可以针对不同的目录指定不同的“置信参数调整因子”，目录下的所有记录中的置信参数都会加上这个调整因子。利用此功能，可以给不同的群加上不同的调整因子，因为不同的群在硬盘上会有不同子目录。一个群里的信息非常可信，就加上正数的调整因子；不太可信，就加上负数的调整因子。



#### 将记录载入内存以供查询

在这个标签页中，可以为YinaoBlacklist指定最多16个.yinao.txt文件，它将读取这些文件中的全部记录，在内存中建立索引，供用户进行查询。



#### 使用内存中的记录进行查询

查询方法有两种。第一种是输入患者的姓名、性别、出生年份进行查找；第二种是输入身份证号进行查找。YinaoBlacklist会把输入的信息经过sha256处理之后，用得到的哈希码来搜索能够与之匹配的记录。为了避免出生年份不精确，还会对年份进行加一和减一之后，再进行两轮查找。

查询可能会返回若干条记录，这些记录按照置信参数的高低进行排序。

这一功能主要提供给分诊的护士使用，护士查询到某患者可能是医闹之后，就会在号条上做特殊的标记，提醒接诊的医生注意，或者直接给接诊的医生发微信提醒。





现在两家公司都持续在远程办公模式，要不咱们周一找个时间zoom碰一下，关于做新链如何设计PoW算法让我们的矿机有绝对优势，还需要再讨论讨论。